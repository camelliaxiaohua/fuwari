---
title: DML语句
category: MySQL
tags:
  - MySQL应用
  - DML
published: 2022-03-03
updated: 2023-03-03
---
---

**DML（Data Manipulation Language，数据操作语言）** 是 SQL 中用于 **操作表中数据** 的核心部分 —— 不涉及表结构（那是 DDL），只关心“增删改”。

### 1. INSERT

用于向表中**添加新行**。

#### 1.1. 单条插入

```sql
INSERT INTO 表名 (列1, 列2, ...) 
VALUES (值1, 值2, ...);
```

> 插入时一定要保证 **列的数量** 和 **VALUES 的数量** 一一对应。类型也要尽量匹配，不然会报错或发生隐式转换。

#### 1.2. 批量插入

```sql
INSERT INTO 表名 (列1, 列2, ...) 
VALUES 
	(值1, 值2, ...),
	(值1, 值2, ...);
```

> 注意单条 SQL 太大时（比如上百万行）可能超过 `max_allowed_packet` 限制。

#### 1.3. 忽略重复

```sql
INSERT IGNORE INTO 表名 (列1, 列2, ..., 列N)
VALUES (值1, 值2, ..., 值N);
```

#### 1.4. 存在则更新不存在则插入

```sql
INSERT INTO 表名 (列1, 列2, ..., 列N)
VALUES (值1, 值2, ..., 值N)
ON DUPLICATE KEY UPDATE
    列1 = 新值1,
    列2 = 新值2,
    ...,
    列N = 新值N;
```

> `ON DUPLICATE KEY UPDATE` 只会在主键或唯一索引冲突时触发。

#### 1.5 插入查询结果

```sql
INSERT INTO 目标表 (列1, 列2, ...)
SELECT 表A.列A, 表B.列B, ...
FROM 表A
JOIN 表B ON 表A.关联列 = 表B.关联列
WHERE 条件;
```

> 从查询结果插入，不用 `VALUES`。

---

### 2. UPDATE

用于**修改已有行的数据**。

#### 2.1. 单表更新

```sql
UPDATE 表名 SET 列1 = 值1, 列2 = 值2 WHERE 条件;
```

> [!warning] 危险操作
> ```sql
>UPDATE 表名 SET 列1 = 值1; -- 更新全表！
> ```
> **生产环境建议开启 `sql_safe_updates = 1` 防止误操作。**

#### 2.2.关联更新：

```sql
UPDATE 表1 [AS 别名1]
JOIN 表2 [AS 别名2] ON 关联条件
[JOIN 表3 ... ON 关联条件]
SET 
    表1.列1 = 新值1,
    表1.列2 = 新值2,
    表2.列3 = 新值3
WHERE 条件;
```

---

### 3. DELETE

用于**删除表中的行**。

#### 3.1 单表删除

```sql
DELETE FROM 表名 WHERE 条件;
```

> [!warning] 危险操作
> ```sql
>DELETE FROM users; -- 删除全表数据！
> ```
> **生产环境建议开启 `sql_safe_updates = 1` 防止误操作。**

#### 3.2. 关联删除

```sql
DELETE u FROM users u
JOIN logs l ON u.id = l.user_id
WHERE l.action = 'delete';
```

> [!warning] 注意
> MySQL 中多表 DELETE 语法和其他数据库不同。

---

### 4. 实用技巧

1. **UPDATE / DELETE 一定要写 WHERE！** → 建议开启 `sql_safe_updates`；

2. **大表 UPDATE/DELETE 分批操作** → 避免长事务、锁表；

```sql
DELETE FROM logs WHERE created_at < '2020-01-01' LIMIT 1000;
```

3. **INSERT 批量比单条快** → 减少网络往返 + 事务开销；

4. **SELECT 避免 `SELECT *`** → 只查需要的列，减少 I/O；

5. **复杂查询用 `EXPLAIN` 分析执行计划**。