---
title: EXISTS子查询中的存在性判断
category: MySQL
tags:
  - MySQL应用
published: 2022-07-12
updated: 2022-07-12
---
---

在 SQL 查询中，我们经常需要根据某些条件来判断是否存在符合要求的数据。MySQL 提供了两种非常有用的操作符：`EXISTS` 和 `NOT EXISTS`，它们能够帮助我们高效地判断子查询是否返回结果。这两者在逻辑上有些相似，但也有重要的差异，本文将详细讲解它们的用法以及常见的应用场景。

### 1. 什么是 `EXISTS` 和 `NOT EXISTS`？

#### 1.1. `EXISTS`

`EXISTS` 是一个逻辑操作符，用于判断 **子查询是否有返回结果**。如果子查询返回至少一行数据，`EXISTS` 返回 `TRUE`；如果子查询没有返回数据，`EXISTS` 返回 `FALSE`。

#### 1.2. `NOT EXISTS`

`NOT EXISTS` 与 `EXISTS` 的作用相反，它用于判断子查询 **是否没有返回任何结果**。如果子查询没有返回数据，`NOT EXISTS` 返回 `TRUE`，如果子查询有结果，返回 `FALSE`。

### 2. `EXISTS` 和 `NOT EXISTS` 的基本语法

#### 2.1. `EXISTS` 语法

```sql
SELECT column_name(s)
FROM table_name
WHERE EXISTS (
    SELECT 1
    FROM subquery_table
    WHERE condition
);
```

- **子查询**：子查询会返回一组结果，如果该结果存在，则 `EXISTS` 返回 `TRUE`，否则返回 `FALSE`。
    
- **`SELECT 1`**：通常在子查询中选择 `1` 或其他常数，因为我们关心的是子查询是否返回数据，而不在乎具体的内容。
    > **为每一条满足条件的记录，返回一个值为 `1` 的结果行。**

#### 2.2. `NOT EXISTS` 语法

```sql
SELECT column_name(s)
FROM table_name
WHERE NOT EXISTS (
    SELECT 1
    FROM subquery_table
    WHERE condition
);
```

- **`NOT EXISTS`**：当子查询没有返回任何数据时，外部查询返回符合条件的结果。
    

### 3. `EXISTS` 和 `NOT EXISTS` 的应用

#### 3.1. `EXISTS` 的应用

`EXISTS` 常用于检查子查询是否返回至少一行数据。通常，这种查询用于 **判断某些条件是否存在**，例如，我们要查找某个表中的记录是否关联了其他表中的数据。

假设我们有两个表：`lfp_housing_group_community` 和 `lfp_housing_group_family`，我们想要查找那些 **没有被分配家庭** 的社区。我们可以使用 `EXISTS` 来判断每个社区是否存在关联的家庭记录。

```sql
SELECT c.id, c.villa_name
FROM lfp_housing_group_community c
WHERE EXISTS (
    SELECT 1
    FROM lfp_housing_group_family f
    WHERE f.community_id = c.id
    AND f.del_flag = '0'
);
```

**解析：**

- 子查询判断 `lfp_housing_group_family` 表中是否存在满足条件的记录。
    
- 如果存在符合条件的家庭记录，则外部查询返回该社区的相关信息。
    

#### 3.2. `NOT EXISTS` 的应用

`NOT EXISTS` 用于检查子查询没有返回任何数据的情况。它非常适合用于 **排除某些记录**，例如，当我们希望查询那些 **没有关联数据的记录**。

假设我们仍然使用 `lfp_housing_group_community` 和 `lfp_housing_group_family` 两个表，但这次我们想要查找 **没有任何家庭** 记录的社区，可以使用 `NOT EXISTS`：

```sql
SELECT c.id, c.villa_name
FROM lfp_housing_group_community c
WHERE NOT EXISTS (
    SELECT 1
    FROM lfp_housing_group_family f
    WHERE f.community_id = c.id
    AND f.del_flag = '0'
);
```

**解析：**

- 子查询会检查每个社区是否存在未删除的家庭记录。
    
- `NOT EXISTS` 会排除那些存在相关家庭记录的社区，最终返回没有家庭记录的社区。
    

### 4. 性能考虑

`EXISTS` 和 `NOT EXISTS` 通常比 `IN` 或 `NOT IN` 更高效，特别是在子查询结果集很大的时候。因为 `EXISTS` 会在找到第一个符合条件的记录时就停止执行，而 `IN` 会返回所有符合条件的记录。

- **`EXISTS`**：返回子查询是否有结果，通常处理大数据时性能更好。
    
- **`NOT EXISTS`**：同理，`NOT EXISTS` 也通常比 `NOT IN` 更高效，特别是在处理 NULL 值时，`NOT IN` 可能会导致不正确的结果。
    

### 5. 总结

- **`EXISTS`** 用于检查子查询是否存在符合条件的数据。
    
- **`NOT EXISTS`** 用于检查子查询是否没有符合条件的数据。
    
- 在处理关联查询时，`EXISTS` 和 `NOT EXISTS` 是非常强大的工具，能够帮助我们高效地筛选数据。
    
- 相比于 `IN` 和 `NOT IN`，`EXISTS` 和 `NOT EXISTS` 在处理大数据集时通常表现更好。
    